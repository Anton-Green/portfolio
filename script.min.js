$(document).ready(function(){var storedUser=getCookie("user"),isSnowfallCookieValue=getCookie("isSnowfallEnabled"),isSnowfallEnabled=null===isSnowfallCookieValue||"true"===isSnowfallCookieValue,snowflakeCreation=("https://anthonyonokin.com/html/users.html"!==window.location.href&&null===storedUser&&(window.location.href="../html/users.html",checkLoginStatus()),setInterval(function(){isSnowfallEnabled?(createSnowflake(),0):clearInterval(snowflakeCreation)},500));function setCookie(name,value,days){var date,expires="";days&&((date=new Date).setTime(date.getTime()+24*days*60*60*1e3),expires="; expires="+date.toUTCString()),document.cookie=name+"="+value+expires+"; path=/"}function getCookie(name){for(var nameEQ=name+"=",cookies=document.cookie.split(";"),i=0;i<cookies.length;i++){for(var cookie=cookies[i];" "===cookie.charAt(0);)cookie=cookie.substring(1,cookie.length);if(0===cookie.indexOf(nameEQ))return cookie.substring(nameEQ.length,cookie.length)}return null}function checkLoginStatus(){$.ajax({url:"../html/php/checkLogin.php",type:"GET",dataType:"json",success:function(response){},error:function(xhr){console.error(xhr.responseText)}})}function displayUserNotes(){$.ajax({url:"../html/php/viewNotes.php",type:"GET",dataType:"json",success:function(response){response&&response.notes?($("#notes-container").empty(),response.notes.forEach(function(note){note='<div class="note" data-note-id="'+note.id+'"><h3>'+note.title+"</h3><p >"+note.content+"</p></div>";$("#notes-container").append(note)}),$("#notes-container").on("click",".note",function(){!function(noteId){$.ajax({url:"../html/php/deleteNote.php",type:"POST",data:{note_id:noteId},dataType:"json",success:function(response){"Note deleted successfully"===response.message?(console.log(response.message),displayUserNotes()):console.error(response.message)},error:function(xhr){console.error(xhr.responseText)}})}($(this).data("note-id")),location.reload()})):console.error("Error fetching user notes")},error:function(xhr,status,error){console.error(xhr.responseText)}})}function createSnowflake(){var snowflake=$("<div class='snowflake'>").appendTo(".snow-container"),startPositionLeft=Math.random()*$(window).width(),endPositionTop=(Math.random(),$(window).height()+2e3),endPositionLeft=startPositionLeft-100+200*Math.random(),durationFall=15e3+5e3*Math.random();snowflake.css({left:startPositionLeft,width:20,height:20}),snowflake.animate({top:endPositionTop,left:endPositionLeft},durationFall,"linear",function(){$(this).remove()})}function imageHandler(object){if(document.getElementById("imageContainer").innerHTML="",null!==object)for(var imageIds=object,i=0;i<imageIds.length;i++){const imageDiv=document.createElement("div");imageDiv.id=imageIds[i],imageDiv.classList.add("grid-item");var imageElement=document.createElement("img"),imageElement=(imageElement.src="../html/php/sendAndGetImage.php?id="+imageIds[i],imageDiv.appendChild(imageElement),document.createElement("button")),imageElement=(imageElement.innerText="delete",imageElement.addEventListener("click",()=>{var imageDivId;imageDivId=imageDiv.id,$.ajax({type:"POST",url:"../html/php/deleteImage.php",data:{imageId:imageDivId},success:function(response){alert("image deleted"),console.log(response),location.reload()},error:function(xhr,status,error){console.error(xhr.responseText)}})}),imageDiv.appendChild(imageElement),document.createElement("button"));imageElement.innerText="download",imageElement.addEventListener("click",function(){var imageId;imageId=imageDiv.id,$.ajax({type:"GET",url:"../html/php/getImagePath.php",data:{id:imageId},dataType:"json",success:function(data){data.error?console.error(data.error):((data=document.createElement("a")).href="../html/php/sendAndGetImage.php?id="+imageId,data.download=`image_${imageId}.png`,document.body.appendChild(data),data.click(),document.body.removeChild(data))},error:function(xhr){console.error(xhr.responseText)}})}),imageDiv.appendChild(imageElement),document.getElementById("imageContainer").appendChild(imageDiv)}else console.log(object)}function musicHandler(musicSearchResults){if(null!==musicSearchResults)for(var searchResultsContainer=document.getElementById("searchResults"),container=(searchResultsContainer.innerHTML="",musicSearchResults),i=0;i<container.length;i++){const audioDiv=document.createElement("div");audioDiv.id=container[i],audioDiv.classList.add("grid-item");var audioElement=document.createElement("audio"),audioElement=(audioElement.controls=!0,audioElement.src="php/getMusic.php?id="+container[i],audioElement.id="audioPlayer"+container[i],audioDiv.appendChild(audioElement),document.createElement("button")),audioElement=(audioElement.innerText="delete",audioElement.addEventListener("click",()=>{var audioDivId;audioDivId=audioDiv.id,$.ajax({type:"POST",url:"../html/php/deleteMusic.php",data:{audioId:audioDivId},success:function(response){alert("audio deleted"),console.log(response),location.reload()},error:function(xhr,status,error){console.error(xhr.responseText)}})}),audioDiv.appendChild(audioElement),document.createElement("button"));audioElement.innerText="download",audioElement.addEventListener("click",function(){var audioId,link;audioId=audioDiv.id,(audioId=document.getElementById("audioPlayer"+audioId))?(audioId=audioId.src,(link=document.createElement("a")).href=audioId,link.download="downloadedAudio",document.body.appendChild(link),link.click(),document.body.removeChild(link)):console.error("Audio element not found")}),audioDiv.appendChild(audioElement),searchResultsContainer.appendChild(audioDiv)}else console.error(response.message)}function changeImage(id){document.getElementById("displayedImage").src="../html/php/sendAndGetImage.php?id="+id}function getOldUsers(){$.ajax({type:"GET",url:"../html/php/sendAndGetHistory.php",dataType:"json",success:function(response){var currentDate=new Date,oldUsers=[],oldUsers=(response.forEach(function(data){var historyDate=new Date(data.user_history);7<(currentDate-historyDate)/864e5&&oldUsers.push(data.user_id)}),!function(oldUsers){$.ajax({type:"POST",url:"../html/php/sendReminder.php",data:JSON.stringify({data:oldUsers}),success:function(response){},error:function(xhr,status,error){console.error(xhr.responseText)}})}(oldUsers),[])},error:function(xhr,status,error){console.error(xhr.responseText)}})}function sendMessage(message_text,receiver_username,container){$.ajax({url:"../html/php/sendMessage.php",type:"POST",data:{message_text:message_text,receiver_username:receiver_username},dataType:"json",success:function(response){getMessages(receiver_username,container)},error:function(xhr,status,error){console.error(xhr.responseText)}})}function getMessages(receiver_username,container){$.ajax({url:"../html/php/getMessages.php",type:"POST",data:{receiver_username:receiver_username},dataType:"json",success:function(response){if(container.empty(),response.messages&&0<response.messages.length)for(var i=0;i<response.messages.length;i++){var messageId=response.messages[i].id,messageText=response.messages[i].message_text,messageId=$('<div class="message" data-message-id="'+messageId+'">'+messageText+"</div>");container.append(messageId),messageId.on("click",function(){var messageId=$(this).data("message-id");console.log(messageId),function(messageId,receiver_username,container){$.ajax({url:"../html/php/deleteMessage.php",type:"POST",data:{messageId:messageId,receiver_username:receiver_username},dataType:"json",success:function(response){"success"===response.status?(console.log("Message deleted successfully"),getMessages(receiver_username,container)):console.error("Error deleting message: "+response.message)},error:function(xhr){console.error(xhr.responseText)}})}(messageId,receiver_username,container)})}},error:function(xhr,status,error){console.error(xhr.responseText)}})}function sendHistory(){$.ajax({type:"POST",url:"../html/php/sendAndGetHistory.php",data:{user_id:user_id,user_history:user_history},success:function(response){},error:function(xhr,status,error){console.error(xhr.responseText)}})}$("#searchImage").click(function(){var searchInput=$("#searchInput").val();$.ajax({url:"../html/php/findImages.php",type:"GET",data:{name:searchInput},dataType:"json",success:function(results){imageHandler(results.map(item=>item.id))},error:function(xhr,status,error){console.error(xhr.responseText)}})}),$("#searchMusic").click(function(){var searchInput=$("#searchInput").val();$.ajax({url:"../html/php/findMusic.php",type:"GET",data:{music_name:searchInput},dataType:"json",success:function(results){console.log(results),musicHandler(results)},error:function(xhr,status,error){console.error(xhr.responseText)}})}),$("#contactForm").submit(function(event){event.preventDefault(),$.ajax({url:"../html/php/insertData.php",type:"POST",data:$(this).serialize(),dataType:"json",success:function(response){alert(response.message)},error:function(xhr,status,error){console.error(xhr.responseText)}})}),$("#registrationForm").submit(function(event){event.preventDefault(),$.ajax({url:"../html/php/register.php",type:"POST",data:$(this).serialize(),dataType:"json",success:function(response){alert(response.message)},error:function(xhr,status,error){console.error(xhr.responseText)}})}),$("#loginForm").submit(function(event){event.preventDefault(),$.ajax({url:"../html/php/login.php",type:"POST",data:$(this).serialize(),dataType:"json",success:function(response){"Login successful"===response.message?(alert(response.message),$("#user-info").html("Welcome, "+response.user.username),setCookie("user",JSON.stringify(response.user),30),window.location.href="userCabinet.html",response.user.id,new Date,sendHistory()):alert("Invalid email or password")},error:function(xhr,status,error){console.error(xhr.responseText)}})}),$("#sendCodeForm").submit(function(event){event.preventDefault();event=$("#email").val();$.ajax({url:"../html/php/resetPasswordRequest.php",type:"POST",data:{email:event},dataType:"json",success:function(response){alert(response.message)},error:function(xhr,status,error){console.error(xhr.responseText)}})}),$("#resetForm").submit(function(event){event.preventDefault();var event=$("#email").val(),resetCode=$("#resetCode").val(),newPassword=$("#newPassword").val();$.ajax({url:"../html/php/resetPasswordProcess.php",type:"POST",data:{email:event,resetCode:resetCode,newPassword:newPassword},dataType:"json",success:function(response){alert(response.message)},error:function(xhr,status,error){console.error(xhr.responseText)}})}),$("#logoutButton").click(function(){$.ajax({url:"../html/php/logout.php",type:"POST",dataType:"json",success:function(response){alert("you logged out"),["user_history","user","isSnowfallEnabled","user_pic"].forEach(function(cookieName){document.cookie=cookieName+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"}),window.location.href="../index.html"},error:function(xhr,status,error){console.error(xhr.responseText)}})}),$("#saveNote").click(function(){var title=$("#noteTitle").val(),content=$("#noteContent").val();$.ajax({url:"../html/php/saveNote.php",type:"POST",data:{title:title,content:content},dataType:"json",success:function(response){alert(response.message)},error:function(xhr,status,error){console.error(xhr.responseText)}}),location.reload()}),$("#toggleSnow").on("click",function(){(isSnowfallEnabled=!isSnowfallEnabled)?(setCookie("isSnowfallEnabled",isSnowfallEnabled,30),snowflakeCreation=setInterval(createSnowflake,500)):(setCookie("isSnowfallEnabled",isSnowfallEnabled,30),clearInterval(snowflakeCreation)),alert(isSnowfallEnabled)}),$("#setUserPic").submit(function(event){event.preventDefault();event=new FormData(this);$.ajax({url:"../html/php/sendAndGetImage.php",type:"POST",data:event,contentType:!1,processData:!1,dataType:"json",success:function(response){alert(response.message),changeImage(response.id),setCookie("user_pic",response.id,30)},error:function(xhr,status,error){console.error(xhr.responseText)}})}),$("#sendImage").submit(function(event){event.preventDefault();event=new FormData(this);$.ajax({url:"../html/php/sendAndGetImage.php",type:"POST",data:event,contentType:!1,processData:!1,dataType:"json",success:function(response){alert(response.message)},error:function(xhr,status,error){console.error(xhr.responseText)}})}),$("#sendMusic").submit(function(event){var formData=new FormData(document.getElementById("sendMusic"));$.ajax({url:"../html/php/sendMusic.php",type:"POST",data:formData,contentType:!1,processData:!1,dataType:"json",success:function(response){alert(response.message)},error:function(xhr,status,error){console.error(xhr.responseText)}})}),storedUser&&(isSnowfallCookieValue=JSON.parse(storedUser),$("#user-info").html("Welcome back, "+isSnowfallCookieValue.username)),"/html/users.html"!==window.location.pathname&&checkLoginStatus(),"/html/userCabinet.html"===window.location.pathname&&(displayUserNotes(),changeImage(null!==(storedUser=getCookie("user_pic"))?storedUser:34),getOldUsers(),getMessages("test",$("#chatContainer"))),"/html/imageGallery.html"===window.location.pathname&&$.ajax({url:"../html/php/sendImagesToGallery.php",type:"POST",dataType:"json",success:function(response){console.log(response),imageHandler(response.image_ids)},error:function(xhr){console.error(xhr.responseText)}}),"/html/musicGallery.html"===window.location.pathname&&$.ajax({url:"../html/php/sendMusicToGallery.php",type:"POST",dataType:"json",success:function(response){musicHandler(response.audio_ids)},error:function(xhr){console.error(xhr.responseText)}}),"/html/notes.html"===window.location.pathname&&displayUserNotes(),$("#searchUser").click(function(){var searchInput=$("#searchInput").val();$.ajax({url:"../html/php/findUser.php",type:"GET",data:{username:searchInput},dataType:"json",success:function(results){for(var userList=document.getElementById("userListContainer"),userChat=document.getElementById("chatWithUserContainer"),usernames=results.map(function(item){return item.username}),i=0;i<usernames.length;i++){var listItem=document.createElement("li");listItem.textContent=usernames[i],listItem.addEventListener("click",function(event){event.preventDefault(),userChat.innerHTML="";event=function(username){var mainDiv=document.createElement("div");(chatInfo=document.createElement("p")).textContent="chat with "+username,mainDiv.appendChild(chatInfo);(chatInfo=document.createElement("div")).id="messagesContainer",mainDiv.appendChild(chatInfo);var chatInfo=document.createElement("form"),inputForMessages=document.createElement("input");return inputForMessages.type="text",inputForMessages.placeholder="write a message",inputForMessages.id="messageInput",chatInfo.appendChild(inputForMessages),(inputForMessages=document.createElement("button")).textContent="send",chatInfo.appendChild(inputForMessages),inputForMessages.addEventListener("click",function(event){event.preventDefault(),sendMessage($("#messageInput").val(),username,$("#messagesContainer"))}),mainDiv.appendChild(chatInfo),(inputForMessages=document.createElement("button")).textContent="hide chat",mainDiv.appendChild(inputForMessages),inputForMessages.addEventListener("click",function(event){event.preventDefault(),mainDiv.remove()}),(chatInfo=document.createElement("button")).textContent="delete chat",mainDiv.appendChild(chatInfo),chatInfo.addEventListener("click",function(event){event.preventDefault()}),mainDiv}(this.textContent);userChat.appendChild(event),getMessages(this.textContent,$("#messagesContainer"))}),userList.appendChild(listItem)}},error:function(xhr,status,error){console.error(xhr.responseText)}})}),$("#sendMessageForm").submit(function(event){event.preventDefault(),sendMessage($("#message_text").val(),$("#receiver_username").val(),$("#chatContainer"))}),$("#sendHTML").submit(function(event){event.preventDefault();event=$("#articleName").val();$.ajax({url:"../html/php/createUserHTML.php",type:"POST",data:{fileName:event},dataType:"json",success:function(response){alert(response.message)},error:function(xhr,status,error){console.error(xhr.responseText)}})}),$("#searchArticle").click(function(){var searchInput=$("#searchInput").val();$.ajax({url:"../html/php/findArticle.php",type:"GET",data:{fileName:searchInput},dataType:"json",success:function(results){for(var articleList=document.getElementById("articleListContainer"),articlePath=results.map(function(item){return item.htmlPath}),articleNames=results.map(function(item){return item.fileName}),articleAuthor=results.map(function(item){return item.author}),i=0;i<articleNames.length;i++)!function(index){var listItem=document.createElement("li");listItem.textContent=articleNames[index]+". Written by: "+articleAuthor[index],listItem.addEventListener("click",function(event){event.preventDefault(),window.location.href=articlePath[index]}),articleList.appendChild(listItem)}(i)},error:function(xhr,status,error){console.error(xhr.responseText)}})})});